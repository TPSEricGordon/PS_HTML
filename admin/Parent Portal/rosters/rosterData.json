[
	~[tlist_sql;

		SELECT
	CONCAT('/admin/contacts/edit.html#?contactid=',P.ID) LINK,
	G.ID AS GROUP_ID,
	G.CODE,
	G.FACILITATOR || ' & ' || G.FACILITATOR2 AS FACILITATOR,
	P.FIRSTNAME || ' ' || P.LASTNAME AS PARENT_NAME,
	'/admin/parent_coaches/enrollment/parent_enrollments.html?id='||P.ID||'&enroll_id='||PE.ID AS ENROLL_LINK,
	-- NO Family ID, May Need Later,
	P.STUDENTS,
	U.FIRST_NAME AS COACH_FIRST
FROM
	(
				-- PARENT DATA
				SELECT
					P.ID,
					P.FIRSTNAME,
					P.LASTNAME,
					LISTAGG(S.FIRST_NAME, ' and ') WITHIN GROUP (ORDER BY S.FIRST_NAME) AS STUDENTS,
					MAX(SE.PARENT_COACH_EMAIL) AS PARENT_COACH
				FROM PS.PERSON p
					JOIN PS.STUDENTCONTACTASSOC SCA
						ON p.ID = SCA.PERSONID
					JOIN PS.STUDENTCONTACTDETAIL SCD
						ON SCA.STUDENTCONTACTASSOCID = SCD.STUDENTCONTACTASSOCID
					LEFT JOIN PS.STUDENTS S
						ON SCA.STUDENTDCID = S.DCID
					JOIN PS.U_DEF_EXT_STUDENTS SE
						ON S.DCID = SE.STUDENTSDCID
				WHERE scd.ISACTIVE=1
				AND (scd.LIVESWITHFLG = 1 OR SCD.ISCUSTODIAL=1)
				GROUP BY P.ID, P.FIRSTNAME, P.LASTNAME

			) P

LEFT JOIN (
	-- PARENT ENROLLMENTS
		SELECT ID,
			ROW_NUMBER() OVER (PARTITION BY PERSONID ORDER BY WHENCREATED DESC) RECENCY,
			PERSONID, GROUP_ID, ENROLL_STATUS, WHENCREATED
		 FROM PS.U_PARENT_CIRCLE_ENROLLMENTS
		 WHERE ENROLL_STATUS=1
		 ) PE

		ON P.ID = PE.PERSONID

LEFT JOIN PS.U_PARENT_GROUPS G
	ON PE.GROUP_ID = G.ID

LEFT JOIN PS.USERS U
	ON U.EMAIL_ADDR = P.PARENT_COACH

 WHERE GROUP_ID = ~(gpv.group_id)

	]

		{"LINK":"~(LINK)",
			"GROUP_ID":"~(GROUP_ID)",
			"CODE":"~(CODE)",
			"FACILITATOR":"~(FACILITATOR)",
			"PARENT_NAME":"~(PARENT_NAME)",
			"ENROLL_LINK":"~(ENROLL_LINK)",
			"STUDENTS":"~(STUDENTS)",
			"COACH":"~(COACH_FIRST)"
		},
	[/tlist_sql]
{}]
