[
	~[tlist_sql;

		SELECT
		'' AS FAMILY_ID,
		parents.NAME,
		CONCAT('/admin/contacts/edit.html#?contactid=',parents.ID) LINK,
		--parents.PHONE,
		'' AS PHONE,
		--parents.CURRENT_GROUP,
		'' AS CURRENT_GROUP,
		'' AS ENROLL_LINK,
		--parents.ENROLL_LINK,
		parents.STUDENTS,
		parents.COHORTS,
		use.FIRST_NAME AS COACH_NAME,
		use.DCID
	FROM (
		SELECT
			P.ID,
			P.FIRSTNAME || ' ' || P.LASTNAME AS NAME,
			LISTAGG(S.FIRST_NAME, ' and ') WITHIN GROUP (ORDER BY S.FIRST_NAME) AS STUDENTS,
			LISTAGG(SE.COHORT, ' and ') WITHIN GROUP (ORDER BY S.FIRST_NAME) AS COHORTS,
			MAX(SE.PARENT_COACH_EMAIL) AS COACH_EMAIL
		FROM PS.PERSON P
			JOIN PS.STUDENTCONTACTASSOC SCA
				ON p.ID = SCA.PERSONID
			JOIN PS.STUDENTCONTACTDETAIL SCD
				ON SCA.STUDENTCONTACTASSOCID = SCD.STUDENTCONTACTASSOCID
			LEFT JOIN PS.STUDENTS S
				ON SCA.STUDENTDCID = S.DCID
			JOIN PS.U_DEF_EXT_STUDENTS SE
				ON SE.STUDENTSDCID = S.DCID
		WHERE scd.ISACTIVE=1
		AND (scd.LIVESWITHFLG = 1 OR SCD.ISCUSTODIAL=1)
		GROUP BY P.ID, P.FIRSTNAME, P.LASTNAME
		) parents

	LEFT JOIN PS.USERS use
				ON parents.COACH_EMAIL = use.EMAIL_ADDR
WHERE use.DCID=~(gpv.coach_id)

	]

		{"FAMILY_ID":"~(FAMILY_ID)",
			"NAME":"~(NAME)",
			"LINK":"~(LINK)",
			"PHONE":"~(PHONE)",
			"CURRENT_GROUP":"~(CURRENT_GROUP)",
			"ENROLL_LINK":"~(ENROLL_LINK)",
			"STUDENT":"~(STUDENT)",
			"COHORT":"~(COHORT)",
			"COACH_NAME":"~(COACH_NAME)"
		},
	[/tlist_sql]
{}]
