[
	~[tlist_sql;
		SELECT
			 CONCAT('/admin/contacts/edit.html#?contactid=',parents.ID) LINK,
			 CASE WHEN G.CODE IS NULL THEN 'None' ELSE G.CODE END AS CURRENT_GROUP,
			 '/admin/parent_coaches/enrollment/parent_enrollments.html?id='||parents.ID||'&enroll_id='||PE.ID AS ENROLL_LINK,
			 parents.ID,
			 parents.FIRSTNAME, parents.lastname,
			 parents.students
		FROM
		(
			SELECT
				P.ID,
				P.FIRSTNAME,
				P.LASTNAME,
				LISTAGG(S.FIRST_NAME || ' ' || S.LAST_NAME, ' and ') WITHIN GROUP (ORDER BY S.FIRST_NAME) AS students
			FROM PS.PERSON p
				JOIN PS.STUDENTCONTACTASSOC SCA
					ON p.ID = SCA.PERSONID
				JOIN PS.STUDENTCONTACTDETAIL SCD
					ON SCA.STUDENTCONTACTASSOCID = SCD.STUDENTCONTACTASSOCID
				LEFT JOIN PS.STUDENTS S
					ON SCA.STUDENTDCID = S.DCID
			WHERE scd.ISACTIVE=1
			AND (scd.LIVESWITHFLG = 1 OR SCD.ISCUSTODIAL=1)
			GROUP BY P.ID, P.FIRSTNAME, P.LASTNAME
		) parents
		LEFT JOIN (
				SELECT ID,
					ROW_NUMBER() OVER (PARTITION BY U_PARENT_DATAID ORDER BY WHENCREATED DESC) RECENCY,
					U_PARENT_DATAID, GROUP_ID, ENROLL_STATUS, WHENCREATED
				 FROM PS.U_PARENT_ENROLLMENTS
				 WHERE ENROLL_STATUS=1
				 )PE
				 -- U PARENT DATA ID MAY WANT TO SWITCH!!!!
				ON parents.ID = PE.U_PARENT_DATAID
		LEFT JOIN PS.U_PARENT_GROUPS G
			ON PE.GROUP_ID = G.ID

			-- WHERE G.CODE IS NOT NULL
		ORDER BY DBMS_RANDOM.VALUE

	]
		{"link":"~(link)",
			"current_group":"~(current_group)",
			"enroll_link":"~(enroll_link)",
			"id":"~(id)",
			"first_name":"~(first_name)",
			"last_name":"~(last_name)",
			"students":"~(students)"
		},
	[/tlist_sql]
{}]
